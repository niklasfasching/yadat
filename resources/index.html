<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <!-- <link href="css/style.css" rel="stylesheet" type="text/css"> -->
  </head>
  <body>
    <style>
     textarea {
       width: 100%;
       height: auto;
     }
    </style>
    <form>
      <div>
        <textarea id="query" name="query" rows="10" cols="80">
{:find [?name]
:where [
[?id :name ?name]
]}</textarea>
      </div>
      <div>
        <button type="button" onclick="executeQuery()">Query</button>
      </div>
    </form>
    <div>
      <textarea id="result" name="result" rows="10" cols="80"></textarea>
    </div>

    <script src="main.js" type="text/javascript"></script>
    <script type="text/javascript">
     /* const schema = {
      *   id: {
      *     "db/unique": "db.unique/identity"
      *   },
      *   sections: {
      *     "db/type": "db.type/ref",
      *     "db/cardinality": "db.cardinality/many",
      *   },
      *   modules: {
      *     "db/type": "db.type/ref",
      *     "db/cardinality": "db.cardinality/many"
      *   },
      *   courses: {
      *     "db/type": "db.type/ref",
      *     "db/cardinality": "db.cardinality/many"
      *   },
      * }; */
     // const db = yadat.js_api.open("sorted-set", schema);
     const db = yadat.js_api.open("minimal", {
       id: ["unique-identity"],
       sections: ["reference", "many"],
       modules: ["reference", "many"],
       courses: ["reference", "many"],
     })

     yadat.js_api.slurp('minimal', './human-factors-moses.json').then((connection) => {

     })

     const majorInsert = fetch('./human-factors-moses.json')
       .then(response => response.json())
       .then(major => yadat.js_api.insert(db, [major]));
     /*
      *      const coursesInsert = fetch('./human-factors-lsf.json')
      *        .then(response => response.json())
      *        .then(courses => yadat.js_api.insert(db, courses)); */
     const coursesInsert = Promise.resolve()
     Promise.all([majorInsert, coursesInsert]).then(() => {
       console.log("loaded")
       executeQuery();
     });

     function executeQuery() {
       const query = document.querySelector("#query").value;
       let result;
       try {
         result = yadat.js_api.query(db, query);
       } catch (e) {
         result = e
       }
       document.querySelector("#result").value =
         JSON.stringify(result, null, 2);
     }
    </script>
  </body>
</html>
